<VirtualHost *:80>
  ServerName <%= node['hostname'] %>
<% if node['ceph']['radosgw']['api_aliases'] -%>
<%   node['ceph']['radosgw']['api_aliases'].each do |api_alias| -%>
  ServerAlias <%= api_alias %>
<%   end -%>
<% end -%>
  ServerAdmin <%= node["ceph"]["radosgw"]["admin_email"] %>
  DocumentRoot <%= node['ceph']['radosgw']['path'] %>

  #turn engine on
  RewriteEngine On

  #following is important for RGW/rados
  RewriteRule ^/([a-zA-Z0-9-_.]*)([/]?.*) /s3gw.fcgi?page=$1&params=$2&%{QUERY_STRING} [E=HTTP_AUTHORIZATION:%{HTTP:Authorization},L]

  <IfModule mod_fcgid.c>
    SuexecUserGroup  wwwrun www
    <Directory <%= node['ceph']['radosgw']['path'] %>>
      Options +ExecCGI
      AllowOverride All
      SetHandler fcgid-script
      FCGIWrapper  <%= node['ceph']['radosgw']['path'] %> .fcgi
      Order allow,deny
      Allow from all
      AuthBasicAuthoritative Off
    </Directory>
  </IfModule>

  AllowEncodedSlashes On

  ErrorLog /var/log/<%= node['apache']['package'] %>/error.log
  CustomLog /var/log/<%= node['apache']['package'] %>/rgw-access.log proxy_combined
  ServerSignature Off 
</VirtualHost>
